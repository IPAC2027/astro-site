---
import ContentLayout from '../../layouts/ContentLayout.astro';
import ContentRenderer from '../../components/ContentRenderer.astro';
import { getEntry } from 'astro:content';

// Get content from the markdown file using Astro content collections
const entry = await getEntry('exhibitors', 'ongoing-projects');
if (!entry) {
  throw new Error('Page content not found');
}

// Use the live markdown-loader to process the content with custom directives
import { loadPageContent } from '../../utils/live-markdown-loader';
const pageContent = loadPageContent('exhibitors/ongoing-projects');

// Extract level 2 headers for table of contents
const headings = pageContent?.blocks
  .filter(block => block.type === 'subtitle' && typeof block.content === 'string')
  .map(block => ({
    text: block.content as string,
    slug: (block.content as string).toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '')
  })) || [];
---

<ContentLayout 
  title={entry.data.title} 
  description={entry.data.description}
  bannerText={entry.data.bannerText || "Ongoing Accelerator Projects"}
  bannerBackground={entry.data.bannerBackground}
  headings={headings}
>
  {pageContent ? (
    <ContentRenderer blocks={pageContent.blocks} />
  ) : (
    <div class="prose prose-lg max-w-none">
      <p>Content will be loaded from the markdown file.</p>
    </div>
  )}
</ContentLayout>
